<Window x:Class="LcmsSpectator.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:LcmsSpectator.Views"
        xmlns:xcad="http://schemas.xceed.com/wpf/xaml/avalondock"
        xmlns:views1="clr-namespace:LcmsSpectator.Views"
        xmlns:controls="clr-namespace:LcmsSpectator.Controls"
        xmlns:models="clr-namespace:LcmsSpectatorModels.Models;assembly=LcmsSpectatorModels"
        xmlns:utils="clr-namespace:LcmsSpectator.Utils"
        Title="LcMsSpectator" WindowState="Maximized">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <utils:ScoreToStringConverter x:Key="ScoreFormatter" />
        <utils:ChargeToStringConverter x:Key="ChargeFormatter" />
        <utils:QValueToStringConverter x:Key="QValueToStringConverter" />
    </Window.Resources>
    <Grid>
        <!-- Menu -->
        <Menu VerticalAlignment="Top">
            <MenuItem Header="_File">
                <MenuItem Header="Open _Raw File" Command="{Binding OpenRawFileCommand}" />
                <MenuItem Header="Open _Id File" Command="{Binding OpenTsvFileCommand}" />
                <MenuItem Header="Open _Target List" DataContext="{Binding CreateSequenceViewModel}" Command="{Binding OpenTargetListCommand}" />
                <MenuItem Header="Search _DMS" Command="{Binding OpenFromDmsCommand}"
                          Visibility="{Binding ShowOpenFromDms, Converter={StaticResource BoolToVis}}" />
            </MenuItem>
            <MenuItem Header="_Config">
                <MenuItem Header="_Settings" Command="{Binding OpenSettingsCommand}" />
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Command="{Binding OpenAboutBoxCommand}" />
            </MenuItem>
        </Menu>
        <!-- End Menu -->
        <Grid HorizontalAlignment="Stretch" Margin="0,22,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="7*" />
                <RowDefinition Height="3" />
                <RowDefinition Height="93*" />
            </Grid.RowDefinitions>
            <!-- Header -->
            <ScrollViewer VerticalAlignment="Top" Grid.Row="0"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                <StackPanel Visibility="{Binding FileOpen, Converter={StaticResource BoolToVis}}">
                    <TextBlock TextAlignment="Center" TextWrapping="Wrap"
                                   Text="{Binding Path=SelectedPrSmViewModel.ProteinNameDesc}"
                                   FontSize="14" FontWeight="Bold"/>
                    <TextBlock TextAlignment="Center" TextWrapping="Wrap" Text="{Binding Path=SelectedPrSmViewModel.SequenceText}"
                                   FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="Charge: " FontWeight="Bold" />
                        <TextBlock Text="{Binding Path=SelectedPrSmViewModel.Charge}" FontWeight="Bold" Width="75" />
                        <TextBlock Text="Precursor M/z: " FontWeight="Bold" />
                        <TextBlock Text="{Binding Path=SelectedPrSmViewModel.PrecursorMz}" FontWeight="Bold" Width="75" />
                        <TextBlock Text="Score: " FontWeight="Bold" />
                        <TextBlock Text="{Binding Path=SelectedPrSmViewModel.Score, Converter={StaticResource ScoreFormatter}}" FontWeight="Bold" Width="75"/>
                        <TextBlock Text="QValue: " FontWeight="Bold" />
                        <TextBlock Text="{Binding Path=SelectedPrSmViewModel.QValue}" FontWeight="Bold" Width="75"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
            <!-- End Header -->
            <GridSplitter Grid.Row="1" HorizontalAlignment="Stretch" ShowsPreview="True" />
            <Grid Grid.Row="2">
                <!-- Ion type selector -->
                <xcad:DockingManager Loaded="Window_OnLoaded" Unloaded="DockingManager_OnUnloaded" Name="AvDock">
                    <xcad:LayoutRoot>
                        <xcad:LayoutRoot.LeftSide>
                            <xcad:LayoutAnchorSide>
                                <xcad:LayoutAnchorGroup>
                                    <xcad:LayoutAnchorable Title="Ion Types" CanClose="False" CanHide="False">
                                        <views1:IonTypeSelector DataContext="{Binding IonTypeSelectorViewModel}" x:Name="IonTypeSelector"/>
                                    </xcad:LayoutAnchorable>
                                    <xcad:LayoutAnchorable Title="Ion List" CanClose="False" CanHide="False">
                                        <views1:IonListView DataContext="{Binding IonListViewModel}" x:Name="IonList" />
                                    </xcad:LayoutAnchorable>
                                </xcad:LayoutAnchorGroup>
                            </xcad:LayoutAnchorSide>
                        </xcad:LayoutRoot.LeftSide>
                        <xcad:LayoutPanel>
                            <xcad:LayoutDocumentPane DockWidth="*">
                                <xcad:LayoutDocument Title="XIC View" CanClose="False">
                                    <xcad:DockingManager AllowMixedOrientation="True" DocumentsSource="{Binding XicViewModels}" x:Name="XicView">
                                        <xcad:DockingManager.LayoutItemTemplate>
                                            <DataTemplate>
                                                <views1:XicView />
                                            </DataTemplate>
                                        </xcad:DockingManager.LayoutItemTemplate>
                                        <xcad:DockingManager.LayoutItemContainerStyle>
                                            <Style TargetType="{x:Type xcad:LayoutItem}">
                                                <Setter Property="Title" Value="{Binding Model.RawFileName}" />
                                                <Setter Property="CloseCommand" Value="{Binding Model.CloseCommand}" />
                                            </Style>
                                        </xcad:DockingManager.LayoutItemContainerStyle>
                                        <xcad:LayoutRoot>
                                            <xcad:LayoutPanel>
                                                <xcad:LayoutDocumentPane />
                                            </xcad:LayoutPanel>
                                        </xcad:LayoutRoot>
                                    </xcad:DockingManager>
                                </xcad:LayoutDocument>
                                <xcad:LayoutDocument Title="Spectrum View" CanClose="False">
                                    <views:SpectrumView DataContext="{Binding Ms2SpectrumViewModel}" x:Name="SpectrumView" />
                                </xcad:LayoutDocument>
                            </xcad:LayoutDocumentPane>
                        <xcad:LayoutAnchorablePaneGroup Orientation="Horizontal" DockWidth="*" DockHeight="200">
                                <xcad:LayoutAnchorablePane IsMaximized="True">
                                    <xcad:LayoutAnchorable Title="Protein Tree" IsMaximized="True">
                                        <Grid x:Name="ProteinTree">
                                            <controls:MvvmTreeView DataContext="{Binding ScanViewModel}" ItemsSource="{Binding FilteredProteins}" SelectedItemTarget="{Binding TreeViewSelectedItem, Mode=TwoWay}">
                                                <controls:MvvmTreeView.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="_Filter by">
                                                            <MenuItem Header="_Sequence" IsCheckable="True" IsChecked="{Binding SequenceFilterChecked}" />
                                                            <MenuItem Header="_Protein" IsCheckable="True" IsChecked="{Binding ProteinFilterChecked}" />
                                                            <MenuItem Header="Precursor _M/Z" IsCheckable="True" IsChecked="{Binding PrecursorMzFilterChecked}" />
                                                            <MenuItem Header="_Charge" IsCheckable="True" IsChecked="{Binding ChargeFilterChecked}" />
                                                            <MenuItem Header="_Score" IsCheckable="True" IsChecked="{Binding ScoreFilterChecked}"/>
                                                            <MenuItem Header="_Q Value" IsCheckable="True" IsChecked="{Binding QValueFilterChecked}"/>
                                                            <MenuItem Header="_Raw File" IsCheckable="True" IsChecked="{Binding RawFileFilterChecked}"/>
                                                            <Separator />
                                                            <MenuItem Header="Clear Filters" Command="{Binding ClearFiltersCommand}" />
                                                        </MenuItem>
                                                    </ContextMenu>
                                                </controls:MvvmTreeView.ContextMenu>
                                                <controls:MvvmTreeView.Resources>
                                                    <HierarchicalDataTemplate DataType="{x:Type models:ProteinId}" ItemsSource="{Binding Proteoforms.Values}">
                                                        <TextBlock Text="{Binding ProteinNameDesc}" />
                                                    </HierarchicalDataTemplate>
                                                    <HierarchicalDataTemplate DataType="{x:Type models:ProteoformId}" ItemsSource="{Binding ChargeStates.Values}">
                                                        <TextBlock Text="{Binding SequenceText}" />
                                                    </HierarchicalDataTemplate>
                                                    <HierarchicalDataTemplate DataType="{x:Type models:ChargeStateId}" ItemsSource="{Binding PrSms.Values}">
                                                        <TextBlock Text="{Binding Charge, Converter={StaticResource ChargeFormatter}}" />
                                                    </HierarchicalDataTemplate>
                                                    <HierarchicalDataTemplate DataType="{x:Type models:PrSm}">
                                                        <TextBlock Text="{Binding ScanText}" />
                                                    </HierarchicalDataTemplate>
                                                </controls:MvvmTreeView.Resources>
                                            </controls:MvvmTreeView>
                                            <Border BorderBrush="Black" BorderThickness="1" Background="#80000000" 
                                            VerticalAlignment="Stretch" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                                                <Grid HorizontalAlignment="Center" VerticalAlignment="Center" >
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="50*"/>
                                                        <RowDefinition Height="50*"/>
                                                    </Grid.RowDefinitions>
                                                    <TextBlock Margin="0"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Bottom"
                                                       Grid.Row="0"
                                                       TextAlignment="Center"
                                                       FontSize="24" FontWeight="Bold" Foreground="#7EFFFFFF">
                                                Loading<LineBreak />Please Wait...
                                                    </TextBlock >
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </xcad:LayoutAnchorable>
                                    <xcad:LayoutAnchorable Title="Scan View">
                                        <Grid x:Name="ScanView">
                                            <DataGrid AutoGenerateColumns="False" SelectionMode="Extended" DataContext="{Binding ScanViewModel}"
                                              IsReadOnly="True" RowHeaderWidth="0"
                                              ItemsSource="{Binding FilteredData}" SelectedItem="{Binding SelectedPrSm}"
                                              Grid.Row="0">
                                                <DataGrid.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="_Filter by">
                                                            <MenuItem Header="_Sequence" IsCheckable="True" IsChecked="{Binding SequenceFilterChecked}" />
                                                            <MenuItem Header="_Protein" IsCheckable="True" IsChecked="{Binding ProteinFilterChecked}" />
                                                            <MenuItem Header="Precursor _M/Z" IsCheckable="True" IsChecked="{Binding PrecursorMzFilterChecked}" />
                                                            <MenuItem Header="_Charge" IsCheckable="True" IsChecked="{Binding ChargeFilterChecked}" />
                                                            <MenuItem Header="_Score" IsCheckable="True" IsChecked="{Binding ScoreFilterChecked}"/>
                                                            <MenuItem Header="_Q Value" IsCheckable="True" IsChecked="{Binding QValueFilterChecked}"/>
                                                            <MenuItem Header="_Raw File" IsCheckable="True" IsChecked="{Binding RawFileFilterChecked}"/>
                                                            <MenuItem Header="Hide _Unidentified Scans" IsCheckable="True" IsChecked="{Binding HideUnidentifiedScans}" />
                                                            <Separator />
                                                            <MenuItem Header="Clear Filters" Command="{Binding ClearFiltersCommand}" />
                                                        </MenuItem>
                                                    </ContextMenu>
                                                </DataGrid.ContextMenu>
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="Scan" Width="5*" Binding="{Binding Scan}"/>
                                                    <DataGridTextColumn Header="Sequence" Width="30*" Binding="{Binding SequenceText}" />
                                                    <DataGridTextColumn Header="Protein" Width="15*" Binding="{Binding ProteinName}" />
                                                    <DataGridTextColumn Header="Precursor M/Z" Width="5*" Binding="{Binding PrecursorMz}" />
                                                    <DataGridTextColumn Header="Charge" Width="5*" Binding="{Binding Charge, Converter={StaticResource ChargeFormatter}}" />
                                                    <DataGridTextColumn Header="Score" Width="5*" Binding="{Binding Score, Converter={StaticResource ScoreFormatter}}" />
                                                    <DataGridTextColumn Header="QValue" Width="5*" Binding="{Binding QValue, Converter={StaticResource QValueToStringConverter}}" />
                                                    <DataGridTextColumn Header="Raw File" Width="30*" Binding="{Binding RawFileName}" />
                                                </DataGrid.Columns>
                                            </DataGrid>
                                            <Border BorderBrush="Black" BorderThickness="1" Background="#80000000" 
                                            VerticalAlignment="Stretch" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                                                <Grid HorizontalAlignment="Center" VerticalAlignment="Center" >
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="50*"/>
                                                        <RowDefinition Height="50*"/>
                                                    </Grid.RowDefinitions>
                                                    <TextBlock Margin="0"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Bottom"
                                                       Grid.Row="0"
                                                       TextAlignment="Center"
                                                       FontSize="24" FontWeight="Bold" Foreground="#7EFFFFFF">
                                                Loading<LineBreak />Please Wait...
                                                    </TextBlock >
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </xcad:LayoutAnchorable>
                                    <xcad:LayoutAnchorable Title="TargetView">
                                        <views1:CreateSequenceView DataContext="{Binding CreateSequenceViewModel}" x:Name="CreateSequence"/>
                                    </xcad:LayoutAnchorable>
                                </xcad:LayoutAnchorablePane>
                            </xcad:LayoutAnchorablePaneGroup>
                        </xcad:LayoutPanel>
                    </xcad:LayoutRoot>
                </xcad:DockingManager>
            </Grid>
        </Grid>
    </Grid>
</Window>
